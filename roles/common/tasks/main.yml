---
# This playbook contains common plays that will be run on all nodes.

- name: Updates apt before installing packages
  apt: update_cache=yes

- name: Install common cli utilities
  apt: name={{ item }} state=installed
  with_items:
   - vim
   - ack-grep
   - git
   - curl
   - build-essential
   - unclutter

- name: Setup motd
  template: src=motd.j2 dest=/etc/motd

- name: Set hostname
  template: src=hostname.j2 dest=/etc/hostname

- name: Add vimrc
  template: src=.vimrc.j2 dest={{ item.path }}
            owner={{ item.owner }} group={{ item.group }}
  with_items:
    - { path: '/home/pi/.vimrc', owner: "{{ user }}", group: "{{ user }}" }
    - { path: '/root/.vimrc', owner: 'root', group: 'root' }

- name: Add bashrc
  template: src=.bashrc.j2 dest={{ item.path }}
            owner={{ item.owner }} group={{ item.group }}
  with_items:
    - { path: '/home/pi/.bashrc', owner: "{{ user }}", group: "{{ user }}" }
    - { path: '/root/.bashrc', owner: 'root', group: 'root' }

- name: Add authorized users to all pis
  template: src=authorized_keys.j2 dest=/root/.ssh/authorized_keys

- name: Setup static ips
  template: src=interfaces.j2 dest=/etc/network/interfaces

# Install vnc
- include: install_vnc.yml

# Turn off screen saver
- include: remove_screensaver.yml

# - name: Install ntp
#   yum: name=ntp state=present
#   tags: ntp

# - name: Configure ntp file
#   template: src=ntp.conf.j2 dest=/etc/ntp.conf
#   tags: ntp
#   notify: restart ntp

# - name: Start the ntp service
#   service: name=ntpd state=started enabled=true
#   tags: ntp

# - name: test to see if selinux is running
#   command: getenforce
#   register: sestatus
#   changed_when: false
